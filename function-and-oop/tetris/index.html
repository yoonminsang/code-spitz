<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <script>
      const prop = (target, value) => Object.assign(target, value);
      const createElement = (element) => document.createElement(element);
      const setBackgroundColor = (style, value) => (style.backgroundColor = value);

      const Data = class extends Array {
        constructor(row, col) {
          super();
          prop(this, { row, col });
        }
        cell(row, col, color, test) {
          if (row > this.row || col > this.col || row < 0 || col < 0 || color === '0') return this;
          const thisRow = this[row] || (this[row] = []);
          if (color && thisRow[col]) test.isIntersacted = true;
          thisRow[col] = color;
          return this;
        }
        rowFn(row, ...color) {
          return color.forEach((v, i) => this.cell(row, i, v)), this;
        }
        all(...rows) {
          return rows.forEach((v, i) => this.rowFn(i, ...v)), this;
        }
      };

      const Renderer = class {
        constructor(col, row) {
          prop(this, { col, row, blocks: [] });
          //   while (row--) this.blocks.push([]);
        }
        clear() {
          throw 'override';
        }
        render(data) {
          if (!(data instanceof Data)) throw 'invalide data';
          this._render(data);
        }
        _render(data) {
          throw 'override!';
        }
      };

      const TableRenderer = class extends Renderer {
        constructor(col, row, backgroundColor) {
          super(col, row);
          this.backgroundColor = backgroundColor;
          this.base = createElement('table');
          while (row--) {
            const tr = this.base.appendChild(createElement('tr')),
              curr = [];
            this.blocks.push(curr);
            let i = col;
            while (i--) curr.push(tr.appendChild(createElement('td')).style);
          }
          this.clear();
        }
        clear() {
          this.blocks.forEach((block) => block.forEach((s) => setBackgroundColor(s, this.backgroundColor)));
        }
        _render(v) {
          this.blocks.forEach((block, row) => block.forEach((s, col) => setBackgroundColor(s, v[row][col])));
        }
      };

      const t = new TableRenderer(5, 5, 'red');
      t.base.style.cssText = `
      width:500px;height:500px;border:0px;
      border-spacing:0;border-collapse:collapse
      `;
      document.body.appendChild(t.base);
      t.render(
        new Data(5, 5).all(
          ['#0f0', '#f00', '#00f', '#ff0', '#0ff'],
          ['#f00', '#f00', '#00f', '#ff0', '#0f0'],
          ['#0f0', '#f00', '#00f', '#ff0', '#0ff'],
          ['#f00', '#f00', '#00f', '#ff0', '#0f0'],
          ['#0f0', '#f00', '#00f', '#ff0', '#0ff'],
        ),
      );
    </script>
  </body>
</html>
